!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t=t||self).Diagram={})}(this,function(t){"use strict";function o(){this.events=[]}function h(t,i){this.x=t||0,this.y=i||0}function r(t){void 0!==t?this.m=t:this.identity()}function i(){}function e(){this.uuid=i.generate(),this.children=[],this.parent=null,this.position=new h(0,0),this.scale=new h(1,1),this.rotation=0,this.layer=0,this.matrix=new r,this.globalMatrix=new r,this.inverseGlobalMatrix=new r,this.matrixNeedsUpdate=!0,this.draggable=!0,this.pointerInside=!1,this.beingDragged=!1}function a(){this.pressed=!1,this.justPressed=!1,this.justReleased=!1}function u(t,i){this._keys=new Array(5),this._position=new h(0,0),this._positionUpdated=!1,this._delta=new h(0,0),this._wheel=0,this._wheelUpdated=!1,this._doubleClicked=new Array(5),this.keys=new Array(5),this.position=new h(0,0),this.delta=new h(0,0),this.wheel=0,this.doubleClicked=new Array(5),this.domElement=void 0!==t?t:window,this.canvas=null,this.events=new o;for(var e=0;e<5;e++)this._doubleClicked[e]=!1,this.doubleClicked[e]=!1,this._keys[e]=new a,this.keys[e]=new a;var s=this;if(void 0!==window.onmousewheel?this.events.add(this.domElement,"mousewheel",function(t){s._wheel=t.deltaY,s._wheelUpdated=!0}):void 0!==window.addEventListener?this.events.add(this.domElement,"DOMMouseScroll",function(t){s._wheel=30*t.detail,s._wheelUpdated=!0}):this.events.add(this.domElement,"wheel",function(t){s._wheel=t.deltaY,s._wheelUpdated=!0}),void 0!==window.ontouchstart||0<navigator.msMaxTouchPoints){var n=new h(0,0);this.events.add(this.domElement,"touchstart",function(t){var i=t.touches[0];s.updatePosition(i.clientX,i.clientY,0,0),s.updateKey(u.LEFT,a.DOWN),n.set(i.clientX,i.clientY)}),this.events.add(this.domElement,"touchend",function(t){s.updateKey(u.LEFT,a.UP)}),this.events.add(this.domElement,"touchcancel",function(t){s.updateKey(u.LEFT,a.UP)}),this.events.add(document.body,"touchmove",function(t){var i=t.touches[0];s.updatePosition(i.clientX,i.clientY,i.clientX-n.x,i.clientY-n.y),n.set(i.clientX,i.clientY)})}this.events.add(this.domElement,"mousemove",function(t){s.updatePosition(t.clientX,t.clientY,t.movementX,t.movementY)}),this.events.add(this.domElement,"mousedown",function(t){s.updateKey(t.which-1,a.DOWN)}),this.events.add(this.domElement,"mouseup",function(t){s.updateKey(t.which-1,a.UP)}),this.events.add(this.domElement,"dragstart",function(t){s.updateKey(t.which-1,a.UP)}),this.events.add(this.domElement,"dblclick",function(t){s._doubleClicked[t.which-1]=!0}),!0!==i&&this.create()}function s(t){this.canvas=t,this.context=t.getContext("2d"),this.context.imageSmoothingEnabled=!0,this.context.globalCompositeOperation="source-over",this.mouse=new u,this.mouse.setCanvas(t)}function n(){this.uuid=i.generate(),this.position=new h(0,0),this.scale=1,this.rotation=0,this.matrix=new r,this.inverseMatrix=new r,this.matrixNeedsUpdate=!0,this.moveOnScale=!0}function c(t,i){this.min=void 0!==t?t:new h,this.max=void 0!==i?i:new h}function m(){e.call(this),this.radius=10,this.strokeStyle="#000000",this.fillStyle="#FFFFFF"}function l(t){e.call(this),this.box=new c(new h(-50,-35),new h(50,35)),this.strokeStyle="#000000",this.fillStyle="#FFFFFF",t&&this.createResizeHelpers()}function d(){e.call(this),this.from=new h,this.to=new h,this.strokeStyle="#000000"}function p(){e.call(this),this.text="",this.font="16px Arial",this.color="#000000"}function y(t){e.call(this),this.image=document.createElement("img"),this.image.src=t}o.prototype.add=function(t,i,e){this.events.push([t,i,e,!1])},o.prototype.clear=function(){this.destroy(),this.events=[]},o.prototype.create=function(){for(var t=0;t<this.events.length;t++){var i=this.events[t];i[0].addEventListener(i[1],i[2]),i[3]=!0}},o.prototype.destroy=function(){for(var t=0;t<this.events.length;t++){var i=this.events[t];i[0].removeEventListener(i[1],i[2]),i[3]=!1}},Object.assign(h.prototype,{set:function(t,i){this.x=t,this.y=i},setScalar:function(t){this.x=t,this.y=t},clone:function(){return new h(this.x,this.y)},copy:function(t){this.x=t.x,this.y=t.y},add:function(t,i){this.x+=t.x,this.y+=t.y},addScalar:function(t){this.x+=t,this.y+=t},addVectors:function(t,i){this.x=t.x+i.x,this.y=t.y+i.y},addScaledVector:function(t,i){this.x+=t.x*i,this.y+=t.y*i},sub:function(t,i){this.x-=t.x,this.y-=t.y},subScalar:function(t){this.x-=t,this.y-=t},subVectors:function(t,i){this.x=t.x-i.x,this.y=t.y-i.y},multiply:function(t){this.x*=t.x,this.y*=t.y},multiplyScalar:function(t){this.x*=t,this.y*=t},divide:function(t){this.x/=t.x,this.y/=t.y},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y)},max:function(t){this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y)},clamp:function(t,i){this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y))},clampScalar:function(t,i){this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y))},clampLength:function(t,i){var e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(i,e)))},floor:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y)},ceil:function(){this.x=Math.ceil(this.x),this.y=Math.ceil(this.y)},round:function(){this.x=Math.round(this.x),this.y=Math.round(this.y)},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y)},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,e=this.y-t.y;return i*i+e*e},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,i){this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i},lerpVectors:function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,i){void 0===i&&(i=0),this.x=t[i],this.y=t[i+1]},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t},rotateAround:function(t,i){var e=Math.cos(i),s=Math.sin(i),n=this.x-t.x,o=this.y-t.y;this.x=n*e-o*s+t.x,this.y=n*s+o*e+t.y}}),r.prototype.copy=function(t){this.m=t.m.slice(0)},r.prototype.clone=function(){return new r(this.m.slice(0))},r.prototype.identity=function(){this.m=[1,0,0,1,0,0]},r.prototype.multiply=function(t){var i=this.m[0]*t.m[0]+this.m[2]*t.m[1],e=this.m[1]*t.m[0]+this.m[3]*t.m[1],s=this.m[0]*t.m[2]+this.m[2]*t.m[3],n=this.m[1]*t.m[2]+this.m[3]*t.m[3],o=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],h=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m=[i,e,s,n,o,h]},r.prototype.premultiply=function(t){var i=t.m[0]*this.m[0]+t.m[2]*this.m[1],e=t.m[1]*this.m[0]+t.m[3]*this.m[1],s=t.m[0]*this.m[2]+t.m[2]*this.m[3],n=t.m[1]*this.m[2]+t.m[3]*this.m[3],o=t.m[0]*this.m[4]+t.m[2]*this.m[5]+t.m[4],h=t.m[1]*this.m[4]+t.m[3]*this.m[5]+t.m[5];this.m=[i,e,s,n,o,h]},r.prototype.compose=function(t,i,e,s,n){this.m=[1,0,0,1,t,i];var o=Math.cos(n),h=Math.sin(n);this.multiply(new r([o,h,-h,o,0,0])),this.scale(e,s)},r.prototype.translate=function(t,i){this.m[4]+=this.m[0]*t+this.m[2]*i,this.m[5]+=this.m[1]*t+this.m[3]*i},r.prototype.rotate=function(t){var i=Math.cos(t),e=Math.sin(t),s=this.m[0]*i+this.m[2]*e,n=this.m[1]*i+this.m[3]*e,o=this.m[0]*-e+this.m[2]*i,h=this.m[1]*-e+this.m[3]*i;this.m[0]=s,this.m[1]=n,this.m[2]=o,this.m[3]=h},r.prototype.scale=function(t,i){this.m[0]*=t,this.m[1]*=t,this.m[2]*=i,this.m[3]*=i},r.prototype.setPosition=function(t,i){this.m[4]=t,this.m[5]=i},r.prototype.getScale=function(){return new h(this.m[0],this.m[3])},r.prototype.getPosition=function(){return new h(this.m[4],this.m[5])},r.prototype.skew=function(t,i){this.multiply(new r([1,Math.tan(i),Math.tan(t),1,0,0]))},r.prototype.determinant=function(){return 1/(this.m[0]*this.m[3]-this.m[1]*this.m[2])},r.prototype.getInverse=function(){var t=this.determinant();return new r([this.m[3]*t,-this.m[1]*t,-this.m[2]*t,this.m[0]*t,t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),t*(this.m[1]*this.m[4]-this.m[0]*this.m[5])])},r.prototype.transformPoint=function(t){return new h(t.x*this.m[0]+t.y*this.m[2]+this.m[4],t.x*this.m[1]+t.y*this.m[3]+this.m[5])},r.prototype.setContextTransform=function(t){t.setTransform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},r.prototype.tranformContext=function(t){t.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},i.generate=function(){for(var n=[],t=0;t<256;t++)n[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,e=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(n[255&t]+n[t>>8&255]+n[t>>16&255]+n[t>>24&255]+"-"+n[255&i]+n[i>>8&255]+"-"+n[i>>16&15|64]+n[i>>24&255]+"-"+n[63&e|128]+n[e>>8&255]+"-"+n[e>>16&255]+n[e>>24&255]+n[255&s]+n[s>>8&255]+n[s>>16&255]+n[s>>24&255]).toUpperCase()}}(),e.prototype.traverse=function(t){t(this);for(var i=this.children,e=0;e<i.length;e++)i[e].traverse(t)},e.prototype.add=function(t){(t.parent=this).children.push(t)},e.prototype.remove=function(t){var i=this.children.indexOf(t);-1!==i&&(this.children[i].parent=null,this.children.splice(i,1))},e.prototype.isInside=function(t){return!1},e.prototype.updateMatrix=function(t){this.matrixNeedsUpdate&&(this.matrix.compose(this.position.x,this.position.y,this.scale.x,this.scale.y,this.rotation),this.globalMatrix.copy(this.matrix),null!==this.parent&&this.globalMatrix.premultiply(this.parent.globalMatrix),this.inverseGlobalMatrix=this.globalMatrix.getInverse())},e.prototype.draw=function(t){},e.prototype.onPointerEnter=null,e.prototype.onPointerLeave=null,e.prototype.onPointerOver=null,e.prototype.onPointerDrag=null,e.prototype.onButtonPressed=null,e.prototype.onButtonDown=null,e.prototype.onButtonUp=null,a.DOWN=-1,a.UP=1,a.RESET=0,(a.prototype.constructor=a).prototype.update=function(t){this.justPressed=!1,this.justReleased=!1,t===a.DOWN?(!1===this.pressed&&(this.justPressed=!0),this.pressed=!0):t===a.UP?(this.pressed&&(this.justReleased=!0),this.pressed=!1):t===a.RESET&&(this.justReleased=!1,this.justPressed=!1)},a.prototype.set=function(t,i,e){this.justPressed=t,this.pressed=i,this.justReleased=e},a.prototype.reset=function(){this.justPressed=!1,this.pressed=!1,this.justReleased=!1},((u.prototype=u).constructor=u).LEFT=0,u.MIDDLE=1,u.RIGHT=2,u.BACK=3,u.FORWARD=4,u.setCanvas=function(t){(this.canvas=t).mouseInside=!1,t.addEventListener("mouseenter",function(){this.mouseInside=!0}),t.addEventListener("mouseleave",function(){this.mouseInside=!1})},u.insideCanvas=function(){return null!==this.canvas&&this.canvas.mouseInside},u.buttonPressed=function(t){return this.keys[t].pressed},u.buttonDoubleClicked=function(t){return this.doubleClicked[t]},u.buttonJustPressed=function(t){return this.keys[t].justPressed},u.buttonJustReleased=function(t){return this.keys[t].justReleased},u.updatePosition=function(t,i,e,s){if(null!==this.canvas){var n=this.canvas.getBoundingClientRect();t-=n.left,i-=n.top}this._position.set(t,i),this._delta.x+=e,this._delta.y+=s,this._positionUpdated=!0},u.updateKey=function(t,i){-1<t&&this._keys[t].update(i)},u.update=function(){for(var t=0;t<5;t++)this._keys[t].justPressed&&this.keys[t].justPressed&&(this._keys[t].justPressed=!1),this._keys[t].justReleased&&this.keys[t].justReleased&&(this._keys[t].justReleased=!1),this.keys[t].set(this._keys[t].justPressed,this._keys[t].pressed,this._keys[t].justReleased),!0===this._doubleClicked[t]?(this.doubleClicked[t]=!0,this._doubleClicked[t]=!1):this.doubleClicked[t]=!1;this._wheelUpdated?(this.wheel=this._wheel,this._wheelUpdated=!1):this.wheel=0,this._positionUpdated?(this.delta.copy(this._delta),this.position.copy(this._position),this._delta.set(0,0),this._positionUpdated=!1):(this.delta.x=0,this.delta.y=0)},u.create=function(){this.events.create()},u.dispose=function(){this.events.destroy()},s.prototype.update=function(t,n){this.mouse.update();var o=this.mouse;n.updateControls(o),n.updateMatrix();var i=o.position.clone(),h=n.inverseMatrix.transformPoint(i);t.traverse(function(t){t.updateMatrix();var i=t.inverseGlobalMatrix.transformPoint(h);if(t.isInside(i)?(t.pointerInside||null===t.onPointerEnter||t.onPointerEnter(o,n),null!==t.onPointerOver&&t.onPointerOver(o,n),o.buttonJustPressed(u.LEFT)&&(null!==t.onButtonDown&&t.onButtonDown(o,n),t.draggable&&(t.beingDragged=!0)),o.buttonPressed(u.LEFT)&&null!==t.onButtonPressed&&t.onButtonPressed(o,n),o.buttonJustReleased(u.LEFT)&&null!==t.onButtonUp&&t.onButtonUp(o,n),t.pointerInside=!0):t.pointerInside&&(null!==t.onPointerLeave&&t.onPointerLeave(o,n),t.pointerInside=!1),o.buttonJustReleased(u.LEFT)&&t.draggable&&(t.beingDragged=!1),t.beingDragged){var e=n.inverseMatrix.clone();e.multiply(t.inverseGlobalMatrix),e.setPosition(0,0);var s=e.transformPoint(o.delta);t.position.add(s),null!==t.onPointerDrag&&t.onPointerDrag(o,n,s)}})},s.prototype.render=function(t,i){var e=this.context;e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,this.canvas.width,this.canvas.height),i.matrix.setContextTransform(e);var s=[];t.traverse(function(t){s.push(t)}),s.sort(function(t,i){return t.layer-i.layer});for(var n=0;n<s.length;n++)e.save(),s[n].globalMatrix.tranformContext(e),s[n].draw(e),e.restore()},n.prototype.updateControls=function(t){if(0!==t.wheel&&(this.scale-=.001*t.wheel*this.scale,this.moveOnScale)){var i=t.wheel/this.scale,e=t.canvas.width/2,s=t.canvas.height/2;this.position.x+=(t.position.x-e)/e*i,this.position.y+=(t.position.y-s)/s*i}t.buttonPressed(u.RIGHT)&&(this.position.x+=t.delta.x,this.position.y+=t.delta.y)},n.prototype.updateMatrix=function(){this.matrixNeedsUpdate&&(this.matrix.compose(this.position.x,this.position.y,this.scale,this.scale,this.rotation),this.inverseMatrix=this.matrix.getInverse())},Object.assign(c.prototype,{set:function(t,i){return this.min.copy(t),this.max.copy(i),this},setFromPoints:function(t){this.min=new h(1/0,1/0),this.max=new h(-1/0,-1/0);for(var i=0,e=t.length;i<e;i++)this.expandByPoint(t[i]);return this},setFromCenterAndSize:function(t,i){var e=(new h).copy(i).multiplyScalar(.5);return this.min.copy(t).sub(e),this.max.copy(t).add(e),this},clone:function(){var t=new c;return t.copy(this),t},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,i){return i.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return(new h).copy(t).clamp(this.min,this.max).sub(t).length()},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),(m.prototype=Object.create(e.prototype)).isInside=function(t){return t.length()<=this.radius},m.prototype.onPointerEnter=function(t,i){this.fillStyle="#CCCCCC"},m.prototype.onPointerLeave=function(t,i){this.fillStyle="#FFFFFF"},m.prototype.draw=function(t){t.fillStyle=this.fillStyle,t.beginPath(),t.arc(0,0,this.radius,0,2*Math.PI),t.fill(),t.lineWidth=1,t.strokeStyle=this.strokeStyle,t.beginPath(),t.arc(0,0,this.radius,0,2*Math.PI),t.stroke()},(l.prototype=Object.create(e.prototype)).createResizeHelpers=function(t){var i=this;function e(){s.position.copy(i.box.min),o.position.copy(i.box.max),n.position.set(i.box.max.x,i.box.min.y),h.position.set(i.box.min.x,i.box.max.y)}var s=new m;s.radius=4,s.onPointerDrag=function(){i.box.min.copy(s.position),e()},this.add(s);var n=new m;n.radius=4,n.onPointerDrag=function(){i.box.max.x=n.position.x,i.box.min.y=n.position.y,e()},this.add(n);var o=new m;o.radius=4,o.onPointerDrag=function(){i.box.max.copy(o.position),e()},this.add(o);var h=new m;h.radius=4,h.onPointerDrag=function(){i.box.min.x=h.position.x,i.box.max.y=h.position.y,e()},this.add(h),e()},l.prototype.onPointerEnter=function(t,i){this.fillStyle="#CCCCCC"},l.prototype.onPointerLeave=function(t,i){this.fillStyle="#FFFFFF"},l.prototype.isInside=function(t){return this.box.containsPoint(t)},l.prototype.draw=function(t){var i=this.box.max.x-this.box.min.x,e=this.box.max.y-this.box.min.y;t.fillStyle=this.fillStyle,t.fillRect(this.box.min.x,this.box.min.y,i,e),t.lineWidth=1,t.strokeStyle=this.strokeStyle,t.strokeRect(this.box.min.x,this.box.min.y,i,e)},(d.prototype=Object.create(e.prototype)).draw=function(t){t.lineWidth=1,t.strokeStyle=this.strokeStyle,t.setLineDash([5,5]),t.beginPath(),t.moveTo(this.from.x,this.from.y),t.lineTo(this.to.x,this.to.y),t.stroke()},(p.prototype=Object.create(e.prototype)).draw=function(t){t.font=this.font,t.textAlign="center",t.fillStyle=this.color,t.fillText(this.text,0,0)},(y.prototype=Object.create(e.prototype)).draw=function(t){t.drawImage(this.image,0,0)},t.Box=l,t.Box2=c,t.Circle=m,t.EventManager=o,t.Image=y,t.Key=a,t.Line=d,t.Matrix=r,t.Mouse=u,t.Object2D=e,t.Renderer=s,t.Text=p,t.UUID=i,t.Vector2=h,t.Viewport=n,Object.defineProperty(t,"__esModule",{value:!0})});